<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† APIs</title>
<style>
body { font-family: Arial, sans-serif; background:#0d1117; color:#f0f6fc; padding:20px; }
button { padding:10px 20px; font-size:1rem; cursor:pointer; background:#1f6feb; border:none; border-radius:5px; color:white; }
.results { margin-top:20px; }
.api-result { background:#161b22; padding:15px; margin-bottom:10px; border-radius:8px; border:1px solid #30363d; }
.api-result h3 { margin-bottom:10px; color:#58a6ff; }
.api-result p { margin:3px 0; }
</style>
</head>
<body>

<h1>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ù…Ù† APIs</h1>
<button id="getLocationBtn">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©</button>

<div id="loading" style="display:none; margin-top:10px;">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹...</div>

<div id="results" class="results"></div>

<script>
document.getElementById('getLocationBtn').addEventListener('click', function() {
    const loading = document.getElementById('loading');
    const resultsDiv = document.getElementById('results');
    loading.style.display = 'block';
    resultsDiv.innerHTML = '';

    if (!navigator.geolocation) {
        alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
        loading.style.display = 'none';
        return;
    }

    let bestPosition = null;
    const desiredAccuracy = 10; // Ù…ØªØ±
    const maxTimeMs = 20000;
    const startTime = Date.now();

    const watchId = navigator.geolocation.watchPosition(
        pos => {
            if (!bestPosition || pos.coords.accuracy < bestPosition.coords.accuracy) {
                bestPosition = pos;
            }

            if (pos.coords.accuracy <= desiredAccuracy || (Date.now() - startTime) > maxTimeMs) {
                navigator.geolocation.clearWatch(watchId);
                showResults(bestPosition);
            }
        },
        err => {
            navigator.geolocation.clearWatch(watchId);
            loading.style.display = 'none';
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ' + err.message);
        },
        { enableHighAccuracy: true, maximumAge:0, timeout:maxTimeMs }
    );

    setTimeout(() => {
        if (watchId) navigator.geolocation.clearWatch(watchId);
        if (bestPosition) showResults(bestPosition);
        else { loading.style.display='none'; alert('Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø©'); }
    }, maxTimeMs+500);

    async function showResults(pos) {
        loading.style.display = 'none';
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        resultsDiv.innerHTML += `<div style="margin-bottom:10px;">ğŸ“ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª GPS: ${lat.toFixed(6)}, ${lon.toFixed(6)} (Ø¯Ù‚Ø© ${Math.round(pos.coords.accuracy)} Ù…ØªØ±)</div>`;

        // APIs
        const apis = [
            {
                name:'Nominatim (OSM)',
                url:`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ar`
            },
            {
                name:'BigDataCloud',
                url:`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=ar`
            },
            {
                name:'Geoapify',
                url:`https://api.geoapify.com/v1/geocode/reverse?lat=${lat}&lon=${lon}&apiKey=YOUR_GEOAPIFY_KEY&lang=ar`
            },
            {
                name:'LocationIQ',
                url:`https://us1.locationiq.com/v1/reverse.php?key=YOUR_LOCATIONIQ_KEY&lat=${lat}&lon=${lon}&format=json&accept-language=ar`
            }
        ];

        for (const api of apis) {
            try {
                const res = await fetch(api.url);
                const data = await res.json();
                let city = '', state='', country='';
                if (api.name==='Nominatim (OSM)') {
                    city = data.address?.city||data.address?.town||data.address?.village||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    state = data.address?.state||'';
                    country = data.address?.country||'';
                } else if (api.name==='BigDataCloud') {
                    city = data.city || data.locality || data.principalSubdivision || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    country = data.countryName || '';
                } else if (api.name==='Geoapify') {
                    city = data.features?.[0]?.properties?.city || data.features?.[0]?.properties?.county || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    state = data.features?.[0]?.properties?.state || '';
                    country = data.features?.[0]?.properties?.country || '';
                } else if (api.name==='LocationIQ') {
                    city = data.address?.city||data.address?.town||data.address?.village||'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                    state = data.address?.state||'';
                    country = data.address?.country||'';
                }

                resultsDiv.innerHTML += `
                <div class="api-result">
                    <h3>${api.name}</h3>
                    <p>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${city}</p>
                    <p>Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${state}</p>
                    <p>Ø§Ù„Ø¯ÙˆÙ„Ø©: ${country}</p>
                    <p>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${lat.toFixed(6)}, ${lon.toFixed(6)}</p>
                </div>`;
            } catch(err) {
                resultsDiv.innerHTML += `<div class="api-result"><h3>${api.name}</h3>Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>`;
            }
        }
    }
});
</script>
</body>
</html>
